<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<script src="./main.js" type="module"></script>
		<title>Document</title>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"
		/>
		<link rel="stylesheet" href="./styles.css" />
	</head>
	<body>
		<header>
			<h1>Alpine & Bulma | test</h1>
		</header>
		<main>
			<section x-data="{...$store.tasks}">
				<h2>Task list</h2>
				<div>
					<h3>In-Progress</h3>
					<ul>
						<template x-for="task in getInProgressTasks()">
							<li
								x-data="{showBody: false, editing: false, taskTitle: task.title, taskBody: task.body}"
							>
								<div x-show="!editing">
									<div>
										<button
											@click="showBody = !showBody"
											x-bind:disabled="task.body.length === 0"
										>
											details
										</button>
										<h4 x-text="task.title"></h4>
										<input
											type="checkbox"
											x-bind:checked="task.status === 'done'"
											@change="toggleTaskStatus(task.id)"
										/>
										<button @click="editing = true">Edit</button>
										<button
											@click="() => {
                                            if(confirm('Are you sure you want to delete this task?')) {
                                                deleteTask(task.id)
                                            }
                                        }"
										>
											delete
										</button>
									</div>
									<div x-show="showBody" x-transition>
										<p x-text="task.body"></p>
									</div>
								</div>
								<div x-show="editing">
									<div>
										<label>
											<span>Task title</span>
											<input x-bind:value="taskTitle" x-model="taskTitle" />
										</label>
										<button
											@click="() => {
                                            if(taskTitle.length > 0) {
                                                updateTask(taskTitle, taskBody, task.id)
                                                editing = false
                                            }
                                        }"
										>
											Save
										</button>
										<button
											@click="() => {
                                            if(taskTitle === task.title && taskBody === task.body) {
                                                taskTitle = task.title
                                                taskBody = task.body
                                                editing = false
                                                return
                                            }
                                            if(confirm('Are you sure you want to discard all the changes?')) {
                                                taskTitle = task.title
                                                taskBody = task.body
                                                editing = false
                                            }
                                        }"
										>
											Discard
										</button>
									</div>
									<div>
										<textarea
											x-bind:value="taskBody"
											x-model="taskBody"
										></textarea>
									</div>
								</div>
							</li>
						</template>
						<li x-data="{creating: false, taskTitle: '', taskBody: ''}">
							<button @click="creating = true" x-show="!creating">
								Create new task
							</button>
							<div x-show="creating">
								<div>
									<label>
										<span>Task title</span>
										<input
											type="text"
											x-model="taskTitle"
											x-bind:value="taskTitle"
											name="taskTitle"
										/>*
									</label>
									<label>
										<span>Task body</span>
										<textarea
											x-model="taskBody"
											x-bind:value="taskBody"
											cols="30"
											rows="10"
											name="taskBody"
										></textarea>
									</label>
								</div>
								<div>
									<button
										@click="() => {
                                        if(taskTitle.length === 0) {
                                            alert('Task title field is empty! Please fill the task title field.')
                                            return
                                        }
                                        createNewTask(taskTitle, taskBody)
                                        taskTitle = ''
                                        taskBody = ''
                                        creating = false
                                    }"
									>
										Save
									</button>
									<button
										@click="() => {
                                        if(!taskTitle && !taskBody) {
                                            taskTitle = ''
                                            taskBody = ''
                                            creating = false
                                            return
                                        }
                                        if(confirm('Are you sure you want to discard all the changes?')) {
                                            taskTitle = ''
                                            taskBody = ''
                                            creating = false
                                        }
                                    }"
									>
										Discard
									</button>
								</div>
							</div>
						</li>
					</ul>
				</div>
				<div>
					<h3>Done</h3>
					<ul>
						<template x-for="task in getDoneTasks()">
							<li
								x-data="{showBody: false, editing: false, taskTitle: task.title, taskBody: task.body}"
							>
								<div x-show="!editing">
									<div>
										<button
											@click="showBody = !showBody"
											x-bind:disabled="task.body.length === 0"
										>
											details
										</button>
										<h4 x-text="task.title"></h4>
										<input
											type="checkbox"
											x-bind:checked="task.status === 'done'"
											@change="toggleTaskStatus(task.id)"
										/>
										<button @click="editing = true">Edit</button>
										<button
											@click="() => {
                                            if(confirm('Are you sure you want to delete this task?')) {
                                                deleteTask(task.id)
                                            }
                                        }"
										>
											delete
										</button>
									</div>
									<div x-show="showBody" x-transition>
										<p x-text="task.body"></p>
									</div>
								</div>
								<div x-show="editing">
									<div>
										<label>
											<span>Task title</span>
											<input x-bind:value="taskTitle" x-model="taskTitle" />
										</label>
										<button
											@click="() => {
                                            if(taskTitle.length > 0) {
                                                updateTask(taskTitle, taskBody, task.id)
                                                editing = false
                                            }
                                        }"
										>
											Save
										</button>
										<button
											@click="() => {
                                            if(taskTitle === task.title && taskBody === task.body) {
                                                taskTitle = task.title
                                                taskBody = task.body
                                                editing = false
                                                return
                                            }
                                            if(confirm('Are you sure you want to discard all the changes?')) {
                                                taskTitle = task.title
                                                taskBody = task.body
                                                editing = false
                                            }
                                        }"
										>
											Discard
										</button>
									</div>
									<div>
										<textarea
											x-bind:value="taskBody"
											x-model="taskBody"
										></textarea>
									</div>
								</div>
							</li>
						</template>
					</ul>
				</div>
			</section>
		</main>
	</body>
</html>
